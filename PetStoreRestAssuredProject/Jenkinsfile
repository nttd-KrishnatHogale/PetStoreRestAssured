pipeline {
    agent any

    environment {
        GITHUB_REPO = 'https://github.com/nttd-KrishnatHogale/PetStoreRestAssured.git'
//         MAVEN_HOME = tool name: 'Maven', type: 'hudson.tasks.Maven$MavenInstallation'
        ALLURE_RESULTS_DIR = 'target/allure-results'
        ALLURE_REPORT_DIR = 'target/allure-report'
        ALLURE_DOWNLOAD_DIR = 'allure-reports'
    }
stages {
        stage('Checkout') {
            steps {
                git url: "${env.GITHUB_REPO}", branch: 'main'
            }
        }

        stage('Build') {
            steps {
            bat 'cd'
            dir('PetStoreRestAssuredProject') {
                                bat 'mvn clean test'
                            }
            }
        }

        stage('Archive Latest Report') {
                    steps {
                        script {
                            // Create the directory for the latest report if it doesn't exist
                            bat "if not exist ${LATEST_REPORT_DIR} mkdir ${LATEST_REPORT_DIR}"

                            // Find and copy the latest report to the directory
                            bat """
                            for /d %%D in (${REPORTS_DIR}\\*) do (
                                xcopy /s /e /y "%%D" "${LATEST_REPORT_DIR}\\"
                            )
                            """
                            // Archive the report
                            archiveArtifacts artifacts: "${LATEST_REPORT_DIR}/**", allowEmptyArchive: true

                        }
                    }
        }

}